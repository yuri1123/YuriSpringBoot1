<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 파일이름을 지칭하는 네임스페이스 -->
<mapper namespace="com.yuls.yspringboot1.boardMapper">

    <!-- 게시글 검색 -->
    <sql id="search">
        <!-- 검색키워드 있을 때 -->
        <if test="keyword != null and keyword != ''">
            AND (
            <choose>
                <!-- 검색 유형이 'subject'일 때 -->
                <when test="searchType != null and searchType == 'subject'">
                    subject LIKE CONCAT('%', #{keyword}, '%')
                </when>
                <!-- 검색 유형이 'content'일 때 -->
                <when test="searchType != null and searchType == 'content'">
                    content LIKE CONCAT('%', #{keyword}, '%')
                </when>
                <!-- 검색 유형이 'createdby'일 때 -->
                <when test="searchType != null and searchType == 'createdby'">
                    createdby LIKE CONCAT('%', #{keyword}, '%')
                </when>
                <!-- 기본적으로 전체 검색 -->
                <otherwise>
                    (subject LIKE CONCAT('%', #{keyword}, '%')
                    OR content LIKE CONCAT('%', #{keyword}, '%')
                    OR createdby LIKE CONCAT('%', #{keyword}, '%'))
                </otherwise>
            </choose>
            )
        </if>
    </sql>

    <!-- 게시글 등록 -->
    <insert id="createboard" parameterType="BoardDto">
        insert into board(subject,content,regdate,moddate,createdby,modifiedby)
        values (#{subject},#{content},now(),now(),#{createdby},#{modifiedby})
    </insert>
    <!-- 게시글 수정 -->
    <update id="updateboard" parameterType="BoardDto">
        update board set subject=#{subject},content=#{content},moddate=now(),modifiedby=#{modifiedby}
        where id=#{id}
    </update>
    <!-- 게시글 전체 조회 -->
    <!-- offset은 SearchDto 클래스의 getOffset() 메서드 리턴값, 조회기준값-->
    <select id="selectboard" parameterType="SearchDto" resultType="BoardDto">
        select * from board
        <include refid="search"/>
        order by id desc limit #{pagination.limitStart}, #{recordSize}
    </select>
    <!-- 게시글 수 카운팅 -->
    <select id="count" parameterType="SearchDto" resultType="java.lang.Integer">
        select count(*) from board
        <include refid="search"/>
    </select>

    <!-- 게시글 조회 by id -->
    <select id="selectbyid" parameterType="java.lang.Long" resultType="BoardDto">
        select * from board where id=#{id}
    </select>
    <!-- 게시글 삭제 -->
    <delete id="deleteboard" parameterType="java.lang.Long">
        delete from board where id=#{id}
    </delete>


</mapper>